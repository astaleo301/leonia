<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leonia - Neutral Eyes</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .animate-fadeIn {
            animation: fadeIn 0.5s ease-out;
        }
        
        .animate-slideUp {
            animation: slideUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
        }

        .line-clamp-2 {
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .line-clamp-3 {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-page {
            column-count: 1;
            column-gap: 3rem;
            text-align: justify;
        }

        @media (min-width: 768px) {
            .book-page {
                column-count: 2;
            }
        }

        .book-content img {
            max-width: 100%;
            height: auto;
            border-radius: 0.75rem;
            margin: 1.5rem auto;
            display: block;
        }

        .book-content h2 {
            font-size: 1.5rem;
            font-weight: 300;
            color: rgb(226 232 240);
            margin: 2rem 0 1rem 0;
            break-after: avoid;
        }

        .book-content h3 {
            font-size: 1.25rem;
            font-weight: 300;
            color: rgb(203 213 225);
            margin: 1.5rem 0 0.75rem 0;
            break-after: avoid;
        }

        .book-content p {
            margin-bottom: 1rem;
            break-inside: avoid;
        }

        .book-content ul, .book-content ol {
            margin: 1rem 0;
            padding-left: 1.5rem;
        }

        .book-content li {
            margin-bottom: 0.5rem;
        }
    </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950">
    <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-orange-950/20 via-transparent to-transparent pointer-events-none"></div>
    
    <!-- Header -->
    <header class="sticky top-0 z-40 backdrop-blur-2xl bg-slate-950/80 border-b border-white/5">
        <div class="container mx-auto px-6 py-5">
            <div class="flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <img src="./images/logo.jpg" alt="Leonia Logo" class="w-11 h-11 rounded-2xl shadow-lg shadow-orange-500/20" onerror="this.onerror=null; this.src='./images/logo.png'; this.onerror=function(){this.style.display='none'; this.nextElementSibling.style.display='flex'};">
                    <div class="w-11 h-11 bg-gradient-to-br from-orange-400/70 to-amber-400/70 rounded-2xl flex items-center justify-center shadow-lg shadow-orange-500/20" style="display:none;">
                        <span class="text-white font-extralight text-xl">L</span>
                    </div>
                    <div>
                        <h1 class="text-xl font-extralight bg-gradient-to-r from-slate-200 via-orange-200 to-amber-300 bg-clip-text text-transparent">
                            Leonia
                        </h1>
                        <p class="text-[10px] text-slate-600 font-light">Neutral Eyes</p>
                    </div>
                </div>
                
                <nav class="flex gap-2" id="nav-buttons"></nav>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-6 py-16 relative" id="main-content">
        <div class="text-center text-slate-400 py-20">
            <p>記事を読み込んでいます...</p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="relative border-t border-white/5 bg-slate-950/50 backdrop-blur-sm mt-24">
        <div class="container mx-auto px-6 py-10">
            <div class="text-center space-y-2">
                <p class="text-slate-500 text-sm font-light">© 2025 Leonia. All rights reserved.</p>
                <p class="text-slate-600 text-xs font-light">Powered by neutral AI technology</p>
            </div>
        </div>
    </footer>

    <!-- Popup Container -->
    <div id="popup-container"></div>

    <script>
        const icons = {
            home: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>',
            bookOpen: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"></path><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"></path></svg>',
            info: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><path d="M12 16v-4"></path><path d="M12 8h.01"></path></svg>',
            mail: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect width="20" height="16" x="2" y="4" rx="2"></rect><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path></svg>',
            share2: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="18" cy="5" r="3"></circle><circle cx="6" cy="12" r="3"></circle><circle cx="18" cy="19" r="3"></circle><line x1="8.59" x2="15.42" y1="13.51" y2="17.49"></line><line x1="15.41" x2="8.59" y1="6.51" y2="10.49"></line></svg>',
            externalLink: '<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" x2="21" y1="14" y2="3"></line></svg>',
            x: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg>',
            twitter: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z"></path></svg>',
            link2: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 17H7A5 5 0 0 1 7 7h2"></path><path d="M15 7h2a5 5 0 1 1 0 10h-2"></path><line x1="8" x2="16" y1="12" y2="12"></line></svg>',
            book: '<svg xmlns="http://www.w3.org/2000/svg" width="56" height="56" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>',
            bookSmall: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"></path></svg>',
            chevronLeft: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="15 18 9 12 15 6"></polyline></svg>',
            chevronRight: '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>'
        };

        let newsArticles = [];
        let researchBooks = [];

        let state = {
            currentPage: 'home',
            selectedArticle: null,
            selectedBook: null,
            selectedChapter: null,
            showPopup: false,
            showBookPopup: false,
            shareMenu: null
        };

        async function loadArticles() {
            try {
                const response = await fetch('./articles/articles.json');
                newsArticles = await response.json();
                renderContent();
            } catch (error) {
                console.error('記事の読み込みに失敗しました:', error);
                newsArticles = getDefaultArticles();
                renderContent();
            }
        }

        async function loadBooks() {
            try {
                const response = await fetch('./books/books.json');
                researchBooks = await response.json();
            } catch (error) {
                console.error('本の読み込みに失敗しました:', error);
                researchBooks = getDefaultBooks();
            }
        }

        function getDefaultArticles() {
            return [
                {
                    id: 1,
                    title: "量子コンピューティングの新たな突破口",
                    category: "テクノロジー",
                    categoryColor: "bg-blue-500/10",
                    categoryText: "text-blue-400",
                    excerpt: "研究チームが室温での量子もつれ状態の維持に成功。量子コンピューティングの実用化に大きく前進。",
                    summary: "国際研究チームが、室温環境下で量子もつれ状態を安定的に維持することに成功しました。これまで超低温環境が必須とされていた量子コンピューティング技術において、画期的な進展となります。この成果により、量子コンピュータの実用化と普及が大きく加速すると期待されています。",
                    content: "<p>国際研究チームが、室温環境下で量子もつれ状態を安定的に維持することに成功しました。これまで超低温環境が必須とされていた量子コンピューティング技術において、画期的な進展となります。</p><h2>研究の背景</h2><p>量子コンピューティングは、従来のコンピュータでは困難な複雑な計算を高速で処理できる次世代技術として注目されています。しかし、量子状態を維持するには極低温環境が必要とされ、実用化の大きな障壁となっていました。</p><h2>今回の成果</h2><p>研究チームは新しい材料と制御技術を開発し、室温でも安定した量子もつれ状態を維持することに成功しました。この技術により、量子コンピュータの小型化とコスト削減が期待されます。</p><h2>今後の展望</h2><p>この成果により、量子コンピュータの実用化と普及が大きく加速すると期待されています。医療、金融、人工知能など、様々な分野での応用が見込まれています。</p>",
                    date: "2025-10-27",
                    image: "https://images.unsplash.com/photo-1635070041078-e363dbe005cb?w=800&q=80"
                }
            ];
        }

        function getDefaultBooks() {
            return [
                {
                    id: 1,
                    title: "量子コンピューティング革命",
                    subtitle: "次世代計算技術の全貌",
                    coverImage: null,
                    coverColor: "from-blue-400 via-cyan-400 to-teal-300",
                    pages: 67,
                    date: "2025-10-20",
                    summary: "本書は、量子コンピューティング技術の最新動向から将来展望まで、AIによる徹底的な調査と分析をまとめた包括的なレポートです。",
                    chapters: []
                }
            ];
        }

        const navItems = [
            { id: 'home', label: 'ホーム', icon: 'home' },
            { id: 'bookshelf', label: '本棚', icon: 'bookOpen' },
            { id: 'about', label: 'About', icon: 'info' },
            { id: 'contact', label: 'Contact', icon: 'mail' }
        ];

        function renderNav() {
            const nav = document.getElementById('nav-buttons');
            nav.innerHTML = navItems.map(item => `
                <button
                    onclick="changePage('${item.id}')"
                    class="flex items-center gap-2 px-4 py-2.5 rounded-xl transition-all text-sm duration-300 font-light ${
                        state.currentPage === item.id 
                            ? 'bg-gradient-to-r from-orange-400/70 to-amber-400/70 text-white shadow-lg shadow-orange-500/20' 
                            : 'text-slate-400 hover:bg-white/5 hover:text-slate-300'
                    }"
                >
                    ${icons[item.icon]}
                    <span class="hidden md:inline">${item.label}</span>
                </button>
            `).join('');
        }

        function changePage(page) {
            state.currentPage = page;
            state.selectedArticle = null;
            renderNav();
            renderContent();
        }

        function showArticlePopup(articleId) {
            state.selectedArticle = newsArticles.find(a => a.id === articleId);
            state.showPopup = true;
            renderPopup();
        }

        function closePopup() {
            state.showPopup = false;
            renderPopup();
        }

        function showBookModal(bookId) {
            state.selectedBook = researchBooks.find(b => b.id === bookId);
            state.showBookPopup = true;
            renderBookPopup();
        }

        function closeBookPopup() {
            state.showBookPopup = false;
            state.selectedChapter = null;
            renderBookPopup();
        }

        function toggleShareMenu(id) {
            state.shareMenu = state.shareMenu === id ? null : id;
            if (state.showPopup) {
                renderPopup();
            } else {
                renderContent();
            }
        }

        function shareArticle(articleId, platform) {
            const article = newsArticles.find(a => a.id === articleId);
            const url = `https://astaleo301.github.io/leonia/?article=${article.id}`;
            const text = article.title;
            
            switch(platform) {
                case 'twitter':
                    window.open(`https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`, '_blank');
                    break;
                case 'copy':
                    navigator.clipboard.writeText(url);
                    showCopyNotification();
                    break;
            }
            state.shareMenu = null;
            if (state.showPopup) {
                renderPopup();
            } else {
                renderContent();
            }
        }

        function showCopyNotification() {
            const notification = document.createElement('div');
            notification.className = 'fixed bottom-8 right-8 bg-gradient-to-r from-orange-400 to-amber-400 text-white px-6 py-3 rounded-xl shadow-lg z-50 animate-slideUp';
            notification.textContent = 'リンクをコピーしました';
            document.body.appendChild(notification);
            setTimeout(() => {
                notification.style.opacity = '0';
                notification.style.transition = 'opacity 0.3s';
                setTimeout(() => notification.remove(), 300);
            }, 2000);
        }

        function renderPopup() {
            const container = document.getElementById('popup-container');
            if (!state.showPopup || !state.selectedArticle) {
                if (!state.showBookPopup) {
                    container.innerHTML = '';
                }
                return;
            }

            const article = state.selectedArticle;
            container.innerHTML = `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fadeIn" onclick="closePopup()">
                    <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-md"></div>
                    <div class="relative bg-gradient-to-br from-slate-800/90 to-slate-900/90 backdrop-blur-2xl rounded-3xl max-w-2xl w-full max-h-[85vh] overflow-y-auto shadow-2xl border border-white/5 animate-slideUp" onclick="event.stopPropagation()">
                        <button onclick="closePopup()" class="sticky top-6 right-6 float-right p-2.5 bg-white/5 hover:bg-white/10 rounded-full transition-all duration-300 backdrop-blur-sm z-10">
                            ${icons.x}
                        </button>
                        
                        <div class="p-10 space-y-6">
                            <img src="${article.image}" alt="${article.title}" class="w-full h-56 object-cover rounded-2xl shadow-xl">
                            
                            <div class="space-y-4">
                                <div class="flex items-center gap-3">
                                    <span class="px-3 py-1.5 ${article.categoryColor} backdrop-blur-sm rounded-full text-xs ${article.categoryText} font-medium border border-white/5">
                                        ${article.category}
                                    </span>
                                    <span class="text-slate-500 text-xs">${article.date}</span>
                                </div>
                                
                                <h2 class="text-3xl font-light text-slate-100 leading-snug">${article.title}</h2>
                                
                                <p class="text-slate-300 leading-relaxed text-base">${article.summary}</p>
                            </div>
                            
                            <div class="pt-6 border-t border-white/5 space-y-4">
                                <p class="text-slate-400 text-sm leading-relaxed">
                                    この記事は、複数の信頼できる情報源から収集されたデータをもとに、AIによって中立的な視点で作成されています。
                                </p>
                                
                                <div class="flex gap-3 flex-wrap">
                                    <button onclick="toggleShareMenu(${article.id})" class="flex items-center gap-2 px-5 py-2.5 bg-white/5 hover:bg-white/10 text-slate-300 rounded-xl transition-all text-sm backdrop-blur-sm">
                                        ${icons.share2}
                                        共有
                                    </button>
                                    
                                    <button onclick="viewArticleDetail(${article.id})" class="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-orange-400/80 to-amber-400/80 hover:from-orange-500/80 hover:to-amber-500/80 text-white rounded-xl transition-all text-sm shadow-lg shadow-orange-500/20">
                                        ${icons.externalLink}
                                        詳細を見る
                                    </button>
                                    
                                    ${state.shareMenu === article.id ? `
                                        <div class="flex gap-2 items-center animate-fadeIn">
                                            <button onclick="shareArticle(${article.id}, 'twitter')" class="p-2.5 bg-white/5 hover:bg-white/10 rounded-xl transition-all backdrop-blur-sm">
                                                ${icons.twitter}
                                            </button>
                                            <button onclick="shareArticle(${article.id}, 'copy')" class="p-2.5 bg-white/5 hover:bg-white/10 rounded-xl transition-all backdrop-blur-sm">
                                                ${icons.link2}
                                            </button>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderBookPopup() {
            const container = document.getElementById('popup-container');
            if (!state.showBookPopup || !state.selectedBook) {
                if (!state.showPopup) {
                    container.innerHTML = '';
                }
                return;
            }

            const book = state.selectedBook;
            
            if (state.selectedChapter) {
                renderChapterReader();
                return;
            }

            const existingContent = container.innerHTML;
            
            const hasChapters = book.chapters && book.chapters.length > 0;
            const tableOfContents = hasChapters ? `
                <div class="space-y-3">
                    <h3 class="text-lg font-medium text-slate-200">目次</h3>
                    <div class="space-y-2">
                        ${book.chapters.map(chapter => `
                            <button onclick="readBookChapter(${book.id}, ${chapter.number})" 
                                class="w-full text-left px-4 py-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all group">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <div class="text-xs text-slate-500">第${chapter.number}章</div>
                                        <div class="text-sm text-slate-300 group-hover:text-orange-300 transition-colors">${chapter.title}</div>
                                    </div>
                                    ${icons.chevronRight}
                                </div>
                            </button>
                        `).join('')}
                    </div>
                </div>
            ` : '';
            
            const bookCover = book.coverImage 
                ? `<img src="${book.coverImage}" alt="${book.title}" class="w-full h-full object-cover rounded-2xl">`
                : `<div class="w-full h-full rounded-2xl bg-gradient-to-br ${book.coverColor} flex items-center justify-center">
                    ${icons.book}
                   </div>`;
            
            container.innerHTML = existingContent + `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fadeIn" onclick="closeBookPopup()">
                    <div class="absolute inset-0 bg-slate-950/80 backdrop-blur-md"></div>
                    <div class="relative bg-gradient-to-br from-slate-800/90 to-slate-900/90 backdrop-blur-2xl rounded-3xl max-w-3xl w-full max-h-[85vh] overflow-y-auto shadow-2xl border border-white/5 animate-slideUp" onclick="event.stopPropagation()">
                        <button onclick="closeBookPopup()" class="sticky top-6 right-6 float-right p-2.5 bg-white/5 hover:bg-white/10 rounded-full transition-all duration-300 backdrop-blur-sm z-10">
                            ${icons.x}
                        </button>
                        
                        <div class="p-10 space-y-6">
                            <div class="flex items-start gap-6">
                                <div class="w-32 h-44 rounded-2xl shadow-2xl flex-shrink-0 overflow-hidden">
                                    ${bookCover}
                                </div>
                                <div class="flex-1 space-y-3">
                                    <h2 class="text-2xl font-light text-slate-100 leading-snug">${book.title}</h2>
                                    <p class="text-slate-400 text-sm">${book.subtitle}</p>
                                    <div class="flex items-center gap-4 text-xs text-slate-500">
                                        <span>${book.pages}ページ</span>
                                        <span>•</span>
                                        <span>${book.date}</span>
                                        ${hasChapters ? `<span>•</span><span>${book.chapters.length}章</span>` : ''}
                                    </div>
                                </div>
                            </div>
                            
                            <p class="text-slate-300 leading-relaxed">${book.summary}</p>
                            
                            ${hasChapters ? `
                                <div class="pt-6 border-t border-white/5">
                                    ${tableOfContents}
                                </div>
                            ` : `
                                <div class="pt-6 border-t border-white/5">
                                    <button onclick="alert('この本の内容は準備中です')" class="w-full flex items-center justify-center gap-2 px-6 py-3.5 bg-gradient-to-r from-orange-400/80 to-amber-400/80 hover:from-orange-500/80 hover:to-amber-500/80 text-white rounded-xl transition-all font-medium shadow-lg shadow-orange-500/20">
                                        ${icons.bookSmall}
                                        本を読む
                                    </button>
                                </div>
                            `}
                        </div>
                    </div>
                </div>
            `;
        }

        function readBookChapter(bookId, chapterNumber) {
            const book = researchBooks.find(b => b.id === bookId);
            if (!book || !book.chapters) return;
            
            const chapter = book.chapters.find(c => c.number === chapterNumber);
            if (!chapter) return;
            
            state.selectedBook = book;
            state.selectedChapter = chapter;
            renderChapterReader();
        }

        function renderChapterReader() {
            const container = document.getElementById('popup-container');
            const book = state.selectedBook;
            const chapter = state.selectedChapter;
            
            const currentIndex = book.chapters.findIndex(c => c.number === chapter.number);
            const hasPrev = currentIndex > 0;
            const hasNext = currentIndex < book.chapters.length - 1;
            
            let chapterContent = '';
            if (chapter.contentType === 'html') {
                chapterContent = chapter.content;
            } else if (chapter.contentType === 'pdf') {
                chapterContent = `<div class="text-center py-10"><iframe src="${chapter.content}" class="w-full h-[600px] rounded-xl border border-white/10"></iframe></div>`;
            } else if (chapter.contentType === 'image') {
                chapterContent = `<div class="text-center"><img src="${chapter.content}" alt="${chapter.title}" class="max-w-full h-auto rounded-xl"></div>`;
            } else {
                chapterContent = chapter.content.split('\n\n').map(paragraph => 
                    `<p class="mb-4">${paragraph.trim()}</p>`
                ).join('');
            }
            
            container.innerHTML = `
                <div class="fixed inset-0 z-50 flex items-center justify-center p-4 animate-fadeIn" onclick="closeBookPopup()">
                    <div class="absolute inset-0 bg-slate-950/90 backdrop-blur-md"></div>
                    <div class="relative bg-gradient-to-br from-slate-800/95 to-slate-900/95 backdrop-blur-2xl rounded-3xl max-w-6xl w-full max-h-[90vh] overflow-hidden shadow-2xl border border-white/5 animate-slideUp flex flex-col" onclick="event.stopPropagation()">
                        
                        <!-- ヘッダー -->
                        <div class="flex items-center justify-between px-8 py-5 border-b border-white/5 flex-shrink-0 bg-slate-900/50">
                            <button onclick="showBookModal(${book.id})" class="flex items-center gap-2 text-slate-400 hover:text-slate-300 transition-colors text-sm">
                                ${icons.chevronLeft}
                                目次に戻る
                            </button>
                            <div class="text-center flex-1 px-4">
                                <div class="text-xs text-slate-500">第${chapter.number}章</div>
                                <div class="text-sm text-slate-300 font-light truncate">${chapter.title}</div>
                            </div>
                            <button onclick="closeBookPopup()" class="p-2 bg-white/5 hover:bg-white/10 rounded-full transition-all flex-shrink-0">
                                ${icons.x}
                            </button>
                        </div>
                        
                        <!-- 本文 -->
                        <div class="flex-1 overflow-y-auto px-8 md:px-16 py-10 bg-gradient-to-b from-slate-900/30 to-slate-950/30">
                            <div class="max-w-5xl mx-auto">
                                <div class="bg-white/[0.02] backdrop-blur-sm rounded-2xl p-8 md:p-12 border border-white/5 shadow-2xl">
                                    <h1 class="text-3xl md:text-4xl font-light text-slate-100 leading-snug mb-8 pb-6 border-b border-white/5">
                                        第${chapter.number}章<br>
                                        <span class="text-2xl md:text-3xl text-orange-300/90">${chapter.title}</span>
                                    </h1>
                                    <div class="book-content text-slate-300 leading-relaxed text-base md:text-lg font-light book-page">
                                        ${chapterContent}
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- フッター（ナビゲーション） -->
                        <div class="flex items-center justify-between px-8 py-5 border-t border-white/5 flex-shrink-0 bg-slate-900/50">
                            ${hasPrev ? `
                                <button onclick="readBookChapter(${book.id}, ${book.chapters[currentIndex - 1].number})" 
                                    class="flex items-center gap-2 px-5 py-2.5 bg-white/5 hover:bg-white/10 text-slate-300 rounded-xl transition-all text-sm">
                                    ${icons.chevronLeft}
                                    前の章
                                </button>
                            ` : '<div></div>'}
                            
                            <div class="text-xs text-slate-500">
                                ${chapter.number} / ${book.chapters.length}
                            </div>
                            
                            ${hasNext ? `
                                <button onclick="readBookChapter(${book.id}, ${book.chapters[currentIndex + 1].number})" 
                                    class="flex items-center gap-2 px-5 py-2.5 bg-gradient-to-r from-orange-400/80 to-amber-400/80 hover:from-orange-500/80 hover:to-amber-500/80 text-white rounded-xl transition-all text-sm shadow-lg shadow-orange-500/20">
                                    次の章
                                    ${icons.chevronRight}
                                </button>
                            ` : '<div></div>'}
                        </div>
                    </div>
                </div>
            `;
        }

        function viewArticleDetail(articleId) {
            state.selectedArticle = newsArticles.find(a => a.id === articleId);
            state.currentPage = 'article';
            state.showPopup = false;
            window.scrollTo({ top: 0, behavior: 'smooth' });
            renderNav();
            renderContent();
            renderPopup();
        }

        function getRandomArticles(excludeId, count = 3) {
            const filtered = newsArticles.filter(a => a.id !== excludeId);
            const shuffled = [...filtered].sort(() => 0.5 - Math.random());
            return shuffled.slice(0, count);
        }

        function renderContent() {
            const main = document.getElementById('main-content');
            
            switch(state.currentPage) {
                case 'home':
                    main.innerHTML = `
                        <div class="space-y-12 animate-fadeIn">
                            <div class="text-center space-y-4 py-12">
                                <h1 class="text-5xl font-extralight bg-gradient-to-r from-slate-300 via-orange-200 to-amber-300 bg-clip-text text-transparent leading-tight">
                                    Neutral Eyes
                                </h1>
                                <p class="text-slate-500 text-sm font-light">中立的な視点で世界を見つめる</p>
                            </div>
                            
                            <div class="max-w-4xl mx-auto space-y-4">
                                ${newsArticles.map(article => `
                                    <div onclick="showArticlePopup(${article.id})" class="group cursor-pointer bg-white/[0.02] backdrop-blur-sm hover:bg-white/[0.04] rounded-2xl border border-white/5 hover:border-white/10 transition-all duration-500 overflow-hidden">
                                        <div class="p-5 flex gap-4">
                                            <img src="${article.image}" alt="${article.title}" class="w-28 h-28 object-cover rounded-xl flex-shrink-0 transition-transform duration-500 group-hover:scale-105">
                                            
                                            <div class="flex-1 flex flex-col justify-between min-w-0">
                                                <div class="space-y-2">
                                                    <div class="flex items-center gap-2">
                                                        <span class="px-2.5 py-1 ${article.categoryColor} backdrop-blur-sm rounded-lg text-xs ${article.categoryText} font-medium">
                                                            ${article.category}
                                                        </span>
                                                        <span class="text-xs text-slate-600">${article.date}</span>
                                                    </div>
                                                    
                                                    <h3 class="font-medium text-slate-200 text-base leading-snug group-hover:text-orange-300 transition-colors duration-300 line-clamp-2">
                                                        ${article.title}
                                                    </h3>
                                                    
                                                    <p class="text-slate-500 text-sm leading-relaxed line-clamp-2">
                                                        ${article.excerpt}
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    `;
                    break;
                
                case 'bookshelf':
                    main.innerHTML = `
                        <div class="space-y-12 animate-fadeIn">
                            <div class="text-center space-y-3">
                                <h2 class="text-4xl font-extralight text-slate-200">調査本棚</h2>
                                <p class="text-slate-500 text-sm font-light">AIによる詳細な調査・分析レポート</p>
                            </div>
                            
                            <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 max-w-5xl mx-auto">
                                ${researchBooks.map(book => {
                                    const bookCover = book.coverImage 
                                        ? `<img src="${book.coverImage}" alt="${book.title}" class="absolute inset-0 w-full h-full object-cover">`
                                        : `<div class="absolute inset-0 bg-gradient-to-br ${book.coverColor}"></div>`;
                                    
                                    return `
                                        <div onclick="showBookModal(${book.id})" class="group cursor-pointer transition-all duration-500 hover:-translate-y-2">
                                            <div class="w-full aspect-[3/4] rounded-2xl shadow-xl group-hover:shadow-2xl transition-all duration-500 flex flex-col items-center justify-center p-6 relative overflow-hidden">
                                                ${bookCover}
                                                <div class="absolute inset-0 bg-gradient-to-t from-black/40 via-black/10 to-transparent"></div>
                                                <div class="relative z-10 flex flex-col items-center justify-center h-full">
                                                    ${!book.coverImage ? icons.book : ''}
                                                    <div class="text-center mt-auto">
                                                        <h3 class="text-white font-medium text-base mb-1 leading-snug drop-shadow-lg">${book.title}</h3>
                                                        <p class="text-white/90 text-xs drop-shadow">${book.subtitle}</p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="mt-3 space-y-1 px-1">
                                                <p class="text-slate-300 text-sm font-light truncate">${book.title}</p>
                                                <div class="flex items-center gap-3 text-xs text-slate-600">
                                                    <span>${book.pages}ページ</span>
                                                    <span>•</span>
                                                    <span>${book.date}</span>
                                                </div>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                    break;
                
                case 'about':
                    main.innerHTML = `
                        <div class="max-w-3xl mx-auto space-y-10 animate-fadeIn">
                            <h2 class="text-4xl font-extralight text-slate-200 text-center">Leoniaについて</h2>
                            <div class="bg-white/[0.02] backdrop-blur-sm rounded-3xl p-10 border border-white/5 space-y-6">
                                <p class="text-slate-300 leading-relaxed font-light">
                                    Leoniaは、AIによる中立的な情報収集と分析を通じて、偏りのないニュースをお届けするプラットフォームです。
                                </p>
                                <p class="text-slate-300 leading-relaxed font-light">
                                    私たちのモットー「Neutral Eyes」は、あらゆる視点から物事を見つめ、読者自身が判断できる情報を提供するという理念を表しています。
                                </p>
                                <p class="text-slate-300 leading-relaxed font-light">
                                    宇宙と銀河をテーマにしたデザインは、広大な視野と無限の可能性を象徴しています。
                                </p>
                            </div>
                        </div>
                    `;
                    break;
                
                case 'contact':
                    main.innerHTML = `
                        <div class="max-w-3xl mx-auto space-y-10 animate-fadeIn">
                            <h2 class="text-4xl font-extralight text-slate-200 text-center">お問い合わせ</h2>
                            <div class="bg-white/[0.02] backdrop-blur-sm rounded-3xl p-10 md:p-16 border border-white/5">
                                <div class="space-y-10">
                                    <div class="text-center space-y-4">
                                        <p class="text-slate-300 leading-relaxed font-light">
                                            Leoniaに関するご質問、ご提案、フィードバックなど、<br>
                                            お気軽にお問い合わせください。
                                        </p>
                                    </div>
                                    
                                    <div class="grid md:grid-cols-2 gap-8">
                                        <div class="bg-white/[0.02] rounded-2xl p-8 border border-white/5 space-y-6">
                                            <h3 class="text-xl font-light text-slate-200 text-center">リンク</h3>
                                            <div class="space-y-4">
                                                <a href="https://twitter.com/leonia_news" target="_blank" class="flex items-center gap-3 px-5 py-3.5 bg-white/5 hover:bg-white/10 rounded-xl transition-all group">
                                                    ${icons.twitter}
                                                    <span class="text-slate-300 group-hover:text-orange-300 transition-colors">Twitter / X</span>
                                                </a>
                                                <a href="mailto:contact@leonia.news" class="flex items-center gap-3 px-5 py-3.5 bg-white/5 hover:bg-white/10 rounded-xl transition-all group">
                                                    ${icons.mail}
                                                    <span class="text-slate-300 group-hover:text-orange-300 transition-colors">Email</span>
                                                </a>
                                            </div>
                                        </div>
                                        
                                        <div class="bg-white/[0.02] rounded-2xl p-8 border border-white/5 space-y-6">
                                            <h3 class="text-xl font-light text-slate-200 text-center">QRコード</h3>
                                            <div class="flex flex-col items-center space-y-4">
                                                <div class="w-48 h-48 bg-white rounded-xl p-4 flex items-center justify-center">
                                                    <img src="./images/qr-code.png" alt="QR Code" class="w-full h-full object-contain" onerror="this.onerror=null; this.parentElement.innerHTML='<div class=\'text-slate-400 text-sm text-center\'>QRコードを<br>準備中です</div>'">
                                                </div>
                                                <p class="text-slate-400 text-xs text-center">スマートフォンでスキャンしてアクセス</p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="pt-6 text-center">
                                        <p class="text-slate-400 text-sm leading-relaxed">
                                            お問い合わせいただいた内容には、できる限り迅速に対応させていただきます。<br>
                                            皆様からのご意見をお待ちしております。
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
                
                case 'article':
                    if (!state.selectedArticle) {
                        changePage('home');
                        return;
                    }
                    const article = state.selectedArticle;
                    const recommendedArticles = getRandomArticles(article.id);
                    
                    main.innerHTML = `
                        <div class="max-w-5xl mx-auto space-y-12 animate-fadeIn">
                            <button onclick="changePage('home')" class="text-orange-400 hover:text-orange-300 flex items-center gap-2 text-sm transition-colors font-light">
                                ${icons.chevronLeft} ホームに戻る
                            </button>
                            
                            <article class="bg-white/[0.02] backdrop-blur-sm rounded-3xl overflow-hidden border border-white/5">
                                <img src="${article.image}" alt="${article.title}" class="w-full h-96 object-cover">
                                
                                <div class="p-8 md:p-12 lg:p-16 space-y-8">
                                    <div class="flex items-center gap-4">
                                        <span class="px-4 py-2 ${article.categoryColor} backdrop-blur-sm rounded-xl text-sm ${article.categoryText} font-medium border border-white/5">
                                            ${article.category}
                                        </span>
                                        <span class="text-slate-500 text-sm">${article.date}</span>
                                    </div>
                                    
                                    <h1 class="text-4xl md:text-5xl font-light text-slate-100 leading-tight">${article.title}</h1>
                                    
                                    <div class="prose prose-invert prose-lg max-w-none">
                                        <div class="text-slate-300 text-lg leading-relaxed font-light space-y-6">
                                            ${article.content || article.summary.split('\n\n').map(p => `<p>${p}</p>`).join('')}
                                        </div>
                                    </div>
                                    
                                    <div class="pt-8 border-t border-white/5 space-y-6">
                                        <p class="text-slate-400 leading-relaxed text-sm font-light">
                                            この記事は、複数の信頼できる情報源から収集されたデータをもとに、AIによって中立的な視点で作成されています。
                                            詳細な分析と追加の情報源については、各セクションで確認することができます。
                                        </p>
                                        
                                        <div class="flex gap-3 flex-wrap">
                                            <button onclick="toggleShareMenu('article')" class="flex items-center gap-2 px-6 py-3 bg-white/5 hover:bg-white/10 text-slate-300 rounded-xl transition-all backdrop-blur-sm">
                                                ${icons.share2}
                                                共有
                                            </button>
                                            ${state.shareMenu === 'article' ? `
                                                <div class="flex gap-2 items-center animate-fadeIn">
                                                    <button onclick="shareArticle(${article.id}, 'twitter')" class="p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all backdrop-blur-sm" title="Twitterで共有">
                                                        ${icons.twitter}
                                                    </button>
                                                    <button onclick="shareArticle(${article.id}, 'copy')" class="p-3 bg-white/5 hover:bg-white/10 rounded-xl transition-all backdrop-blur-sm" title="リンクをコピー">
                                                        ${icons.link2}
                                                    </button>
                                                </div>
                                            ` : ''}
                                        </div>
                                    </div>
                                </div>
                            </article>
                            
                            ${recommendedArticles.length > 0 ? `
                                <div class="space-y-6">
                                    <h2 class="text-2xl font-light text-slate-200">おすすめの記事</h2>
                                    <div class="grid md:grid-cols-3 gap-6">
                                        ${recommendedArticles.map(rec => `
                                            <div onclick="viewArticleDetail(${rec.id})" class="group cursor-pointer bg-white/[0.02] backdrop-blur-sm hover:bg-white/[0.04] rounded-2xl border border-white/5 hover:border-white/10 transition-all duration-500 overflow-hidden">
                                                <img src="${rec.image}" alt="${rec.title}" class="w-full h-40 object-cover transition-transform duration-500 group-hover:scale-105">
                                                <div class="p-5 space-y-3">
                                                    <div class="flex items-center gap-2">
                                                        <span class="px-2.5 py-1 ${rec.categoryColor} backdrop-blur-sm rounded-lg text-xs ${rec.categoryText} font-medium">
                                                            ${rec.category}
                                                        </span>
                                                        <span class="text-xs text-slate-600">${rec.date}</span>
                                                    </div>
                                                    <h3 class="font-medium text-slate-200 text-sm leading-snug group-hover:text-orange-300 transition-colors duration-300 line-clamp-3">
                                                        ${rec.title}
                                                    </h3>
                                                </div>
                                            </div>
                                        `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `;
                    break;
            }
        }

        // URL パラメータから記事IDを取得して表示
        function checkUrlParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const articleId = urlParams.get('article');
            if (articleId) {
                const article = newsArticles.find(a => a.id == articleId);
                if (article) {
                    viewArticleDetail(article.id);
                }
            }
        }

        // Initialize
        renderNav();
        loadArticles().then(() => checkUrlParams());
        loadBooks();
    </script>
</body>
</html>
